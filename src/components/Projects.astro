---
import projectsTitles from "../data/projects-titles.json";

const { limit } = Astro.props;

const projects = await Astro.glob("../pages/projects/*.md");

const requiredProjectsTitles = projectsTitles.slice(0, limit);

const requiredProjects = projects.filter((project) =>
  requiredProjectsTitles.includes(project.frontmatter.title)
);

const isProjectsPage = new URL(Astro.request.url).pathname === "/projects";
---

<style lang="scss">
  .project {
    > div {
      .stacks {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 3;
      }

      .links a {
        @apply flex text-3xl hover:no-underline;
      }
    }
  }
</style>

<section id="projects">
  <div class="max-w-[1200px] mx-auto p-8">
    <h2 class="text-center text-rose-600">
      <span>Projects I have Worked On</span>
    </h2>

    <div class="flex flex-col justify-center">
      {requiredProjects.map(async (project) => {
        const {
          title,
          description,
          screenshot_filename,
          logo_filename,
          live_demo,
          github_repo,
          stacks,
        } = project.frontmatter

        const { default: src } = await (screenshot_filename
          ? import(`../images/${screenshot_filename}.png`)
          : logo_filename
          ? import(`../images/${logo_filename}.svg`)
          : {})

        const hashedStacks = stacks
          ?.map((stack) => `#${stack.replace("\\@", "@").toLowerCase()}`)
          .join(" ")

        return (
          <div class="project p-8 gap-6 flex flex-col md:flex-row justify-center items-center">
            <img
              src={src}
              alt={title}
              class:list={[
                "md:w-[37.5%] rounded-lg drop-shadow-2xl",
                { "bg-slate-900 p-8": !!logo_filename },
              ]}
            />

            <div class="grid p-4 md:w-[62.5%]">
              <h3 class="text-blue-600">{title}</h3>

              <p>{description}</p>

              {stacks && (
                <p class="stacks text-teal-700">
                  <strong class="text-rose-600">#stacks: </strong>
                  {hashedStacks}
                </p>
              )}

              <div class="links my-4 gap-3 flex justify-end items-center">
                <a href={live_demo}>
                  <i
                    class="iconify"
                    data-icon={
                      logo_filename ? "logos:npm-icon" : "bx:link-external"
                    }
                    data-width={!logo_filename && "2.375rem"}
                  />
                </a>

                {() => {
                  if (typeof github_repo === "string") {
                    return (
                      <a href={github_repo}>
                        <i class="iconify" data-icon="logos:github-icon" />
                      </a>
                    )
                  }

                  return (
                    <Fragment>
                      <a href={github_repo.client_side}>
                        <i class="iconify" data-icon="logos:github-icon" />
                      </a>

                      <a href={github_repo.server_side}>
                        <i class="iconify" data-icon="logos:github-icon" />
                      </a>
                    </Fragment>
                  )
                }}
              </div>
            </div>
          </div>
        )
      })}
    </div>
  </div>
</section>
